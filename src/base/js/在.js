require.config({baseUrl:"../../../../",paths:{jquery:"lib/jquery/jquery-1.9.1.js?v=397754ba49",rrtconfig:"JCenterHome/www/config/rrtconfig.js?v=e85ff82afc",hometpl:"JCenterHome/www/home/js/hometpl.js?v=c42ecbe36c",layout:"base/tpl/JCenterHome_hd/js/hd_ft.js?v=d9b6ffa8ba",infoHelper:"JCenterHome/www/helper/informationHelper.js?v=4d14f541ff",commentHelper:"JCenterHome/www/myspace/js/commentHelper.js?v=84e7515bb5",JCenterHelper:"JCenterHome/www/helper/JCenterHelper.js?v=167c0a5808",shareHelper:"JCenterHome/www/helper/shareHelper.js?v=75eb2a30fe",favorHelper:"JCenterHome/www/helper/favorHelper.js?v=1877d8ec0a",tools:"base/js/requiretools.js?v=4a4ca9da64",md5:"lib/md5/MD5.js?v=5bf3a64fc4",supportSpaceData:"JCenterHome/www/data/supportSpaceData.js?v=f10b22595b",layer:"lib/layer/layer.js?v=b0abd8f830",dialog:"JCenterHome/www/myspace/js/appDialog.js?v=fcda21b94a",ajaxhelper:"JCenterHome/www/myspace/js/ajaxhelper.js?v=ea43d4c391",callWork:"JCenterHome/www/myspace/js/callWork.js?v=46d0ae0b6c",service:"base/js/service.js?v=e008072f84",template:"lib/arTtemplate/template.js?v=dd622e58c9",jqueryJedate:"JCenterHome/www/myspace/js/jquery.jedate.min.js?v=d4c0944047",home:"JCenterHome/www/home/js/home.js?v=e69059a0b7",commentHtmlHelper:"JCenterHome/www/helper/commentHtmlHelper.js?v=3cfdc925ee"}}),define("index",["jquery","home","hometpl","rrtconfig","infoHelper","commentHelper","layout","JCenterHelper","shareHelper","favorHelper","tools","callWork","supportSpaceData","layer","dialog","ajaxhelper","template","jqueryJedate","service"],function(e,t,a,i,n,s,r,l,o,d,c,p,h,u,f,m,v,g,_){function w(){var t=e("#app-list").find("li").length;e("#app-list").css("width","186"*t);var a=e(".left_app"),i=e(".right_app"),n=e(".app_ul"),s=n.find("li").outerWidth(!0);t>=5?e(".right_app").css({"border-left":"none"}):e(".right_app").css({"border-left":"1px #e0e0e0 solid"}),i.click(function(){n.stop().animate({"margin-left":-s},500,function(){n.find("li").eq(0).appendTo(n),n.css({"margin-left":0})})}),a.click(function(){n.find("li:last").prependTo(n),n.css({"margin-left":-s}),n.stop().animate({"margin-left":0},500)})}function k(t){t=t.data;for(var a=0,i=!1;a<t.length;a++)for(var n=(new Date).getTime(),s=t[a].terms,r=0,l=0,o=[];r<s.length;r++){o[0]=s[r].teachStartTime.split(".");var d=new Date(o[0][0],o[0][1]-1,o[0][2]).getTime();o[1]=s[r].teachEndTime.split(".");var c=new Date(o[1][0],o[1][1]-1,o[1][2]).getTime();if(n<c&&n>d){e(".choose-value1").html(t[a].name+s[r].termName),i=!0;var p=ie(d,c);ge={callStr:b(p[0],p[1])},ee(),ne((new Date).getTime())}else if(n>c&&c>l){l=c;var h=[];h.a=d,h.name=t[a].name,h.name_=s[r].termName}}if(!i){var p=ie(h.a,l);return ge={callStr:b(p[0],p[1])},ee(),ne((new Date).getTime()),h.name+h.name_}}function y(e){for(var t="",a="",i=0,n=!0;e>0;){var s=e%10;0===s?n||(n=!0,a=fe[s]+a):(n=!1,t=fe[s],t+=ue[i],a=t+a),i++,e=Math.floor(e/10)}return a}function D(e){var t=0,a="",i="",n=!1;if(0===e)return fe[0];for(;e>0;){var s=e%1e4;n&&(i=fe[0]+i),a=y(s),i=a+i,n=s<1e3&&s>0,e=Math.floor(e/1e4),t++}return i=i.replace(/一十/,"十")}function b(e,t){var a=e.split("-"),i=0,n={clearStr:new Date(a[0],a[1]-1,a[2]),strOld:""},s={TimeList:[],selectList:[]};if(1!==n.clearStr.getDay())return"日期开始需为周1当前为周"+errTime;for(var r=0;r<t;r++){n.strNew=[],0==r&&(i=1==String(parseInt(a[2])).length?"0"+parseInt(a[2]):parseInt(a[2])),a[1]=1==a[1].length?"0"+a[1]:a[1],n.strOld=a[0]+"/"+a[1]+"/"+i;var l=parseInt(i)+6;i=parseInt(i)+7,l>=28&&(l=new Date(a[0],a[1]-1,l).getDate());var o="";i>=28&&(i=new Date(a[0],a[1]-1,i).getDate())<8&&(11==new Date(a[0],a[1]-1,i).getMonth()&&(o=12),a[1]=parseInt(a[1])+1,a[1]>12&&(a[1]=a[1]-12,a[0]=parseInt(a[0])+1)),l=1==String(l).length?"0"+l:l,i=1==String(i).length?"0"+i:i,a[1]=1==String(a[1]).length?"0"+a[1]:a[1],o?s.TimeList.push("第"+(r+1)+"周 ("+n.strOld+"-"+a[0]+"/"+o+"/"+l+")"):s.TimeList.push("第"+(r+1)+"周 ("+n.strOld+"-"+a[0]+"/"+a[1]+"/"+l+")"),s.selectList.push("第"+D(r+1)+"周")}return s}function x(){e("#choose-ul").html("");for(var t="",a=0;a<ge.callStr.selectList.length;a++)t+="<li data-id='"+a+"'><span>"+ge.callStr.selectList[a]+"</span></li>";e("#choose-ul").append(t)}function C(t){t=t.data;for(var a=[],i=[],n=0;n<t.length;n++){var s=[],r=[];t[n].terms[0]&&(t[n].terms[0].termName&&a.push(t[n].name+t[n].terms[0].termName),s.push(t[n].terms[0].teachStartTime),s.push(t[n].terms[0].teachEndTime),s.push(t[n].terms[0].weeks),i.push(s)),t[n].terms[1]&&(a.push(t[n].name+t[n].terms[1].termName),r.push(t[n].terms[1].teachStartTime),r.push(t[n].terms[1].teachEndTime),r.push(t[n].terms[1].weeks),i.push(r))}for(var l="",n=0;n<a.length;n++)l+="<li data-id='"+n+"'data-start='"+i[n][0]+"'data-end='"+i[n][1]+"'data-weeks='"+i[n][2]+"'><span>"+a[n]+"</span></li>";e(".serach-box1 span:first-child").html(a[0]),e("#choose-ul1").append(l)}function T(t,a){if(void 0===t)e(".tap_slide_main").html(ge.callStr.TimeList[0]);else{var i=ge.callStr.TimeList[t+a];e(".tap_slide_main").text(i),e(".choose-value").text(ge.callStr.selectList[t+a])}}function j(){e(".a_title").each(function(){e(this).text().length>20&&(e(this).text(e(this).text().substring(0,20)),e(this).html(e(this).html()+"…"))})}function S(t){var a=JCenterHomeHost+"backlogs?appId="+t;e.ajax({type:"GET",url:a,success:function(t){var a=Math.ceil(t.data.length/10),i="";t.data&&t.data.length>0?(e.each(t.data,function(e){e>=10*(me.pageno-1)&&e<10*me.pageno&&(i+='<li flag="'+t.data[e].flag+'"><span class="li_span '+_e[t.data[e].flag]+'">【<span class="datatype" app-id="'+t.data[e].appId+'">'+t.data[e].appName+'</span>】</span><a class="a_title"  data-account="'+t.data[e].account+'" data-href="'+t.data[e].link+'" href="javascript:void(0);" title="'+t.data[e].title+'">'+t.data[e].title+"</a><strong>"+t.data[e].date+"</strong></li>")}),e(".app_table_ul").html(i),j(),H(a,1)):e(".app_table .app_table_ul").empty().append('<div><div class="empty-Panel"><img src="../images/nocontent.png?v=e851e12e73"><br>没有您查看的内容</div></div>')},error:function(e){4011==e.status&&l.login()}})}function H(t,a){1==a?e(".page").addClass("pageOrange"):e(".page").addClass("pageBlue");var i="";1==me.pageno?i+='<p title="已是首页" class="prev_btn nohting_left _Left"><span class="prev_bg"></span></p>':i+='<p class="prev_btn _Left"><a href="javascript:void(0);"><span class="prev_bg"></span></a></p>',i+='<ul class="pag_box _Left"><div class="pag_wrap">';for(var n=Number(me.pageno-t),s=Number(t);n<=s;n++)n<=t&&n>=1&&(n!=me.pageno?i+='<li><a class="li_start" data-start="'+n+'" href="javascript:void(0);">'+n+"</a></li>":i+='<li class="active"><a href="#">'+n+"</a></li>");i+="</div></ul>",me.pageno==t?i+='<p title="已是尾页" class="next_btn nohting_right  _Left"><span class="next_bg"></span></p>':i+='<p class="next_btn _Left"><a href="javascript:void(0);"><span class="next_bg"></span></a></p>',e(".S_right").html(i)}function I(e){we.indexOf(e)<0&&we.push(e)}function J(t){e.when(L(t)).done(function(){m.getAppCategory({success:function(t){var a='<li class="header-li" data-id="0"><span class="act">全部</span></li>';for(var i in t.data)we.indexOf(t.data[i].id)>=0&&(a+='<li class="header-li" data-id="'+t.data[i].id+'"><span>'+t.data[i].name+"</span></li>");e(".header-list").html(a),N()},fail:function(){u.alert("请登录后再试")}})})}function L(t){var a=0==parseInt(t)?{}:{category:parseInt(t)};return m.getAppList({data:a,success:function(t){var a="";if(t.data.length)for(var i=0;i<t.data.length;i++)t.data[i].isShow&&(I(t.data[i].category),12==t.data[i].id&&(t.data[i].appUrl=t.data[i].appUrl+"&totype=area"),a+='<li><span class="span_icon"><img src="'+E(t.data[i].logo)+'" alt=""> </span> <span class="span_info">'+t.data[i].name+'</span> <div class="href"> <div class="href_box"></div>',1==t.data[i].kindCode?a+='<a class="into btn" target="_blank" data-kindCode="'+t.data[i].kindCode+'" data-href="'+t.data[i].appUrl+'"  appId="'+t.data[i].id+'" title="请先到应用中心下载安装，否则无法进入应用">进入应用</a>':2==t.data[i].kindCode?a+='<a class="into btn" target="_blank" data-kindCode="'+t.data[i].kindCode+'" data-href="'+t.data[i].appUrl+'"  appId="'+t.data[i].id+'">进入应用</a>':a+='<a class="into btn" target="_blank" data-kindCode="'+t.data[i].kindCode+'" data-href="'+t.data[i].appUrl+'"  appId="'+t.data[i].id+'" title="请到应用中心下载安装">进入应用</a>',a+="</div></li>");e("#app-list").html(a),w(),e(".into").each(function(){e(this).click(function(){var t=e(this),a="";2==t.data("kindcode")&&(a=window.open("about:blank")),m.isLogin({success:function(){m.enterApp({data:{appId:t.attr("appId")},success:function(e){1==t.data("kindcode")?window.location.href=e.data:2==t.data("kindcode")&&(a.location.href=e.data)},fail:function(){2==t.data("kindcode")&&a.close(),u.alert("您没有相应权限")}})},fail:function(){u.alert("请登录后再试")}})})})},fail:function(){e("#app-list").empty().append(f.noContent("没有查到对应应用哦")),u.alert("请登录后再试")}})}function W(){var t=z(),a=0==parseInt(t)?{}:{category:parseInt(t)};m.getAppList({data:a,success:function(e){f.addAppDialog(e,function(e){var t="";for(var a in e.appId)t+=e.appId[a]+",";m.addApps({data:t,success:function(){J(z()),u.alert("添加应用成功")},fail:function(){}})})},fail:function(){e("#app-list").empty().append(f.noContent("没有查到对应应用哦")),u.alert("请登录后再试")}})}function N(){e(".header-li").each(function(){e(this).click(function(){e(this).find("span").hasClass("act")||(e(this).find("span").addClass("act").parents(".header-li").siblings().each(function(){e(this).find("span").removeClass("act")}),L(e(this).data("id")))})}),e("#add-app").on("click",function(){W()})}function z(){var t="0";return e(".header-li").each(function(){if(e(this).find("span").hasClass("tab-choose"))return void(t=e(this).data("id"))}),t}function E(e){return"http"===_.path_url.download_url.substring(0,4)?_.path_url.download_url.replace("#resid#",e):_.prefix+_.path_url.download_url.replace("#resid#",e)}function M(t){me.pageno=t,S(e("#serach-box .choose-value").attr("data-id")),e(window).scrollTop(0)}function A(){u.open({type:2,title:"",skin:"class_do",area:["700px","600px"],fixed:!0,top:"15%",content:"class.html"})}function O(t,a,i){i||q(e(".select_child"),pe.data.studentinfo),e(".todo").css("border-width","0px"),a="todo_ul_add_c",U(t,a),e("#pageTool").css("display","none"),e("#pageTool_c").css("display","none"),2==pe.data.usertype?e(".edit_img").css("display","block"):5==pe.data.usertype&&e(".select_child").css("display","block")}function q(e,t){for(var a=0,i="";a<t.length;a++)i+='<option id="'+t[a].uid+'">'+t[a].classname+"</option>";e.html(i)}function U(t,a,i){if(teacher_id=pe.data.uid,2==pe.data.usertype)var n="teacher";else if(3==pe.data.usertype){var n="classid";teacher_id=pe.data.classid}else if(5==pe.data.usertype){var n="people";teacher_id=e(".select_child option:selected").attr("id"),i&&(teacher_id=i)}Y(),e.ajax({url:JCenterHomeHost+"/culum?type="+n+"&id="+teacher_id,type:"GET",success:function(e){if(e&&"success"==e.type){var i={am_sum:0,pm_sum:0},n=e.data;for(var s in n)"1"==n[s].day?i.am_sum=n[s].lesson:"2"==n[s].day&&(i.pm_sum=n[s].lesson);0==i.am_sum?Y():(e.class=i,t.html(v(a,e)))}else u.alert("获取个人信息异常",{icon:0})},error:function(e){u.alert("获取个人信息异常11",{icon:0})}})}function Y(){var t={am_sum:4,pm_sum:4},a={one:"语文",two:"数学",three:"英语",four:"物理",five:"化学",six:"自然",seven:"体育"},i={code:"success",class:t,subject:[a,a,a]};i&&"success"==i.code?e(".todo .todo_ul").html(v("todo_ul_add_none",i)):u.alert("获取异常",{icon:0})}function P(e){return e=e.split("-"),new Date(e[0],e[1]-1,e[2]).getTime()}function B(e){if(0!=e){e=new Date(e);var t=e.getHours(),a=e.getMinutes();return t=t<10?"0"+t:t,a=a<10?"0"+a:a,t+":"+a}}function G(e,t){if(e=e.split("-"),e[0]=e[0].slice(-4),e[2]=String(e[2]).slice(-3,-1),1==arguments.length)return e;var a=new Date(e[0],e[1]-1,e[2]).getTime();if(""==t)return a;if("00:00"==t)return a;var i="",n=t.split(":")[0],s=t.split(":")[1],r=t.split(":")[2]||0;i=Number(3600*n)+Number(60*s)+Number(r);return a+1e3*i}function F(t,a){e.ajax({url:JCenterHomeHost+"/schedules",type:"GET",data:{type:2,start:P(t),end:P(a)+864e5,schoolId:pe.data.orgid},success:function(e){"success"==e.type&&(pe.msgDate=e,R(e.data,t,a,'<span class="act"></span>'))},error:function(e){4011==e.status&&ae("获取信息失败！"),console.log(e)}})}function V(t,a){e.ajax({url:JCenterHomeHost+"/schedules",type:"GET",data:{userId:pe.data.uid,type:1,start:P(t),end:P(a)+864e5},success:function(e){"success"==e.type&&(pe.msgDate=e,R(e.data,t,a,""))},error:function(e){4011==e.status&&ae("获取信息失败！"),console.log(e)}})}function R(e,t,a,i){for(var n=e.length,n=parseInt(P(t)),s=0;s<e.length;s++){var r=Math.floor(parseInt(parseInt(e[s].start)-n)/864e5),l=e[s].start;e[s].start=B(e[s].start),e[s].end=B(e[s].end),Z(pe.arr[r],e[s],l,s,e.length-1,i)}K(),Q()}function Z(t,a,i,n,s,r){var l;l="00:00"==a.start&"00:00"==a.end?"":a.start+"-"+a.end,a.personInCharge||(a.personInCharge=""),a.location||(a.location=""),a.author||(a.author=""),a.isimportant?isImportant="isImportant":isImportant="",e("."+t+" .week_event_show").append('<ul class="split_td" data-zid="'+a.id+'" data-uid="'+a.userId+'"><li>'+l+'</li><li title="'+a.location+'">'+a.location+'</li><li class="event_wrapper" date-start="'+i+'"><p class="'+isImportant+'" title="'+a.affair+'">'+r+a.affair+'</p><div class="operation"><div class="oper_list oper_update"><div><img src="images/update.png" alt=""></div><p>编辑</p></div><div class="oper_list oper_remove"><div><img src="images/remove.png" alt=""></div><p>删除</p></div></div></li><li title="'+a.personInCharge+'">'+a.personInCharge+'</li><li title="'+a.author+'">'+a.author+'</li><li title="'+a.remark+'">'+a.remark+"</li></ul>")}function $(t){var a=e(t).attr("class").replace("week ",""),i=e(".tap_slide_main").html().split("/")[0].slice(-4);return pe.arrC[pe.arr.indexOf(a)]+" （"+i+"-"+e(t).find(".week-box p:first-child").text().slice(0,2)+"-"+e(t).find(".week-date").text()+"）"}function K(){X();e(".oper_update").get(0);e(".oper_update").click(function(t){e(".wrapper").hide(),e(".ok_update").show();var a=e(this).parent().parent();pe.thisDate=a.parent().parent().parent(),pe.thisDate=$(pe.thisDate);var i=a.prev().prev().text();""==i?(pe.upDate.start="00:00",pe.upDate.end="00:00"):(i=i.split("-"),pe.upDate.start=i[0].split(":"),pe.upDate.end=i[1].split(":"),pe.upDate.start=pe.upDate.start[0]+":"+pe.upDate.start[1],pe.upDate.end=pe.upDate.end[0]+":"+pe.upDate.end[1]),pe.upDate.id=a.parent().attr("data-zid"),pe.upDate.id=a.parent().attr("data-zid"),pe.upDate.affair=e(this).parent().prev().text(),pe.upDate.location=a.prev().text(),pe.upDate.remark=a.next().next().next().text(),pe.upDate.type=e(this).prev().text(),pe.upDate.personInCharge=a.next().text(),de(t),e(".add_week_wrapper .add_week_title p").text("更改周历"),e(this).parent().prev().find(".act").length>0&&(e(".change_week_kind").find("p:last-child").prev().removeClass("act"),e(".change_week_kind").find("p:last-child").addClass("act")),e("#laydateWeekDay").val(pe.thisDate),""!=pe.upDate.end&&e("#appTimeEnd2").val(pe.upDate.end),""!=pe.upDate.start&&e("#appTimeStart1").val(pe.upDate.start),""!=pe.upDate.personInCharge&&e("input[name=personInCharge]").val(pe.upDate.personInCharge),""!=pe.upDate.remark&&e("input[name=remark]").val(pe.upDate.remark),""!=pe.upDate.affair&&e("input[name=affair]").val(pe.upDate.affair),""!=pe.upDate.location&&e("input[name=location]").val(pe.upDate.location),pe.upDate.father=a.parent().parent().parent().attr("class").replace(/week/,"").trim()}),e(".ok_update .submit_btn").click(function(t){t.preventDefault();var a=(pe.upDate.father,e(".form_week").serializeArray()),i={};i.type=e(".change_week_kind .act").attr("data-isz"),i.id=pe.upDate.id;for(var n=0;n<a.length;n++)i[a[n].name]=a[n].value;i.start=G(i.weekDay,i.start),i.end=G(i.weekDay,i.end),le(i)&&(i.userId=pe.data.uid,i.orgid=pe.data.orgid,i.author=pe.data.username,oe(),se(i),ce())}),e(".oper_remove").click(function(){var t=e(this).parent().parent().parent().attr("data-zid");de("prompt"),e(".prompt").show();var a=e(this).parent().parent().parent();e(".yesRmove").click(function(i){i.preventDefault(),e(a).remove(),te(t),Q(),ce()}),e(".clearRmove").click(function(e){e.preventDefault(),ce()}),e(".prompt").click(function(e){e.preventDefault(),ce()}),e(".mask").click(function(e){e.stopPropagation()})})}function Q(t){e(".week").each(function(){var t=e(this).find(".split_td").length;e(this).find(".count span").html(t),0==t?e(this).find(".week_time_show").css("height","58px"):1==t?(e(this).find(".week_time_show").css("height","58px"),e(this).find(".split_td li").css({height:"58px","line-height":"58px"})):0!==t&&(e(this).find(".week_time_show").css("height",46*t+"px"),e(this).find(".split_td li").css({height:"46px","line-height":"44px"}))})}function X(){e(".split_td").mouseover(function(){e(this).attr("data-uid")==pe.data.uid&&e(this).find(".operation").show()}),e(".split_td").mouseout(function(){e(this).find(".operation").hide()})}function ee(){var t=e(".tap_slide_main").html().split("-")[0].split("/");t[0]=t[0].slice(-4);var a,i=t.join("-");e(".week").each(function(){e(this).find(".week-box p:first-child").html(t[1]+"月"),e(this).find(".week-date").html(t[2]),a=t[0]+"-"+t[1]+"-"+t[2],new Date(t[0],t[1]-1,t[2]).getDate()!=parseInt(t[2])?(t[2]="01",t[1]=parseInt(t[1])+1,t[1]=1==String(t[1]).length?"0"+t[1]:t[1],e(this).find(".week-box p:first-child").html(t[1]+"月"),e(this).find(".week-date").html(t[2]),a=t[0]+"-"+t[1]+"-"+t[2],t[2]=parseInt(t[2])+1,t[2]=1==String(t[2]).length?"0"+t[2]:t[2]):(t[2]=parseInt(t[2])+1,t[2]=1==String(t[2]).length?"0"+t[2]:t[2])}),oe(),F(i,a),V(i,a),Q()}function te(t){e.ajax({url:JCenterHomeHost+"/schedules/del",type:"post",data:"id="+t,success:function(e){ae("删除成功！")},error:function(e){4011==e.status&&ae("获取信息失败！"),console.log(e)}})}function ae(t,a){var i=a||1200;e("body").append('<p class="err_hint">'+t+"</p>"),setTimeout(function(){e("body>.err_hint").remove()},i)}function ie(e,t){t+=864e5;var a,i,n,s,e=new Date(e);a=e.getFullYear(),i=e.getMonth()+1,n=e.getDate();for(var r=0;r<7;r++){if(1==new Date(a,i-1,n).getDay()){var l=new Date(a,i-1,n);a=l.getFullYear(),i=l.getMonth()+1,n=l.getDate(),i=i<10?"0"+i:i,n=n<10?"0"+n:n,s=a+"-"+i+"-"+n;break}n--}var o=Math.ceil((t-l)/864e5/7);return Array(s,o)}function ne(e){function t(e,t){var a=[];a.push(e[t].slice(-4)),cacheStrs=parseInt(e[t+1])-1,a.push(cacheStrs),a.push(e[t+2].slice(0,2));var a=new Date(a[0],a[1],a[2]).getTime();return a}var a=ge.callStr.TimeList.length,i=t(ge.callStr.TimeList[0].split("/"),0),n=t(ge.callStr.TimeList[a-1].split("/"),2);pe.thatTimeBoth=[i,n];var s=!1;if(1==new Date(i).getDay()){Math.ceil((n-i)/864e5/7)}else{Math.ceil((n-i)/864e5/7)}if("endTime"==e)return n;for(var r=i,l=0;r<n;r+=6048e5)e>r&&e<r+6048e5&&(T(l,0),s=!0),l++;s||T(0,0)}function se(t,a){e.ajax({type:"post",url:JCenterHomeHost+"/schedules",data:t,success:function(e){e.data&&ne(e.data.start),ae("add"==a?"添加成功！":"修改成功！"),ee()},error:function(e){ae(4011==e.status?"获取信息失败！":"add"==!a?"添加失败！":"修改失败！"),console.log(e)}}),e(".laydate_week_wrapper input").val("00:00"),e(".form_week .week_event input").val(""),e(".act[data-isz=2]")&&(e("p[data-isz=1]").addClass("act"),e("p[data-isz=2]").removeClass("act"))}function re(t,a){e(".add_week>p:first-child").text(a).show();setTimeout(function(){e(".add_week>p:first-child").text("").hide()},1500);return t.focus(),t}function le(t){return t.start>ne("endTime")?(re(e("#laydateWeekDay"),"添加时间超过本学年时间！"),!1):(new Date).getTime()>t.start?(re(e("#appTimeStart1"),"不能在当前时间之前添加或改动！"),!1):pe.thatTimeBoth[0]<t.start&&t.start>pe.thatTimeBoth[1]?(re(e("#appTimeStart1"),"所添加时间不在本学期范围内！"),!1):""==e("input[name=affair]").val()?(re(e("input[name=affair]"),"事件不能为空!"),!1):""==e("#appTimeStart1").val()||""==e("#appTimeEnd2").val()||"00:00"==e("#appTimeStart1").val()||"00:00"==e("#appTimeEnd2").val()?(re(e("#appTimeStart1"),"开始时间和结束时间不能为空！"),!1):"NaN"==t.end&&"NaN"==t.start?(re(e("#appTimeStart1"),"时间类型不匹配！"),!1):!(t.end<t.start)||(re(e("#appTimeStart1"),"开始时间不能大于结束时间！"),!1)}function oe(){e(".week").each(function(){e(this).find(".week_event_show").html("")}),Q()}function de(t){"prompt"==t?e(".prompt").show():e(".add_week_wrapper").show(),localStorage.setItem("srcollH",e(document).scrollTop()),e("body").css({overflow:"hidden",height:"100%"}),pe.data.ptUsertype!=he.admin&&(e(".change_week_kind p").unbind("click"),e(".change_week_kind p:last-child").addClass("disabled").attr("title","没有权限"))}function ce(t){e(".add_week_wrapper").css("display","none"),e(".prompt").hide(),e("body").css({overflow:"auto"}),e(document).scrollTop(localStorage.srcollH)}var pe={data:"underfind",msgDate:"underfind",upDate:{},isAddWeek:"",thisDate:"",thatTimeBoth:[],arr:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],arrC:["星期一","星期二","星期三","星期四","星期五","星期六","星期日"]},he={admin:300,teacher:2,studend:3,family:5},ue=["","十","百","千"],fe=["零","一","二","三","四","五","六","七","八","九"],me={pageno:1},ve=JCenterHomeHost+"memberinfo";e.ajax({type:"get",url:ve,success:function(t){pe.data=t;var a=JCenterHomeHost+"schedules/yearTerm?schoolId="+pe.data.orgid;e.ajax({type:"get",url:a,success:function(t){if(500==t.code){pe.isAddWeek=!1;var a=e(".week-Calendar").append('<p class="mDisabled"></p>').height();return e(".mDisabled").height(a+45),!1}var i=k(t);x(),C(t),e(".choose-value1").html(i)},fail:function(e){window.location.href="../interspace/interspace.html"}})},fail:function(e){window.location.href="../interspace/interspace.html"}});var ge={callStr:b("2017-8-21",16)};e("body").on("click",".serach-box0",function(t){if(t.stopPropagation(),e(this).find("ul").is(":hidden")){var a=e(".choose-value0").text();e(this).find("ul").show().focus().children().removeClass("darkbg").each(function(){if(a==e(this).find("span").text())return void e(this).addClass("darkbg")}),e(this).find("#serach-icon0").removeClass("icon-list-down0").addClass("icon-list-up0")}else e(this).find("ul").hide(),e(this).find("#serach-icon0").removeClass("icon-list-up0").addClass("icon-list-down0")}),e("body").on("click",".serach-box0 ul li",function(t){t.stopPropagation();var a=e(this).parents(".serach-box0").find(".choose-value0"),i=e(this).children("span").text();a.attr("data-id",e(this).attr("data-id")),e(this).parent().hide().parent().find("#serach-icon0").removeClass("icon-list-up0").addClass("icon-list-down0"),e(this).siblings().removeClass("darkbg").end().addClass("darkbg"),i!==e(".choose-value0").text()&&e(".choose-value0").text(i),S(e("#serach-box0 .choose-value0").attr("data-id"))}),e("body").on("click",".serach-box",function(t){if(t.stopPropagation(),e(this).find("ul").is(":hidden")){var a=e(".choose-value").text();e(this).find("ul").show().focus().children().removeClass("darkbg").each(function(){if(a==e(this).find("span").text())return void e(this).addClass("darkbg")}),e(this).find("#serach-icon").removeClass("icon-list-down").addClass("icon-list-up")}else e(this).find("ul").hide(),e(this).find("#serach-icon").removeClass("icon-list-up").addClass("icon-list-down")}),e("body").on("click",".serach-box ul li",function(t){t.stopPropagation();var a=e(this).parents(".serach-box").find(".choose-value"),i=e(this).children("span").text();a.attr("data-id",e(this).attr("data-id")),e(this).parent().hide().parent().find("#serach-icon").removeClass("icon-list-up").addClass("icon-list-down"),e(this).siblings().removeClass("darkbg").end().addClass("darkbg"),e(".choose-value").text(i);var n=e(this).attr("data-id");e(".tap_slide_main").text(ge.callStr.TimeList[n]),oe(),ee()}),e("body").on("click",".serach-box1",function(t){if(t.stopPropagation(),e(this).find("ul").is(":hidden")){var a=e(".choose-value1").text();e(this).find("ul").show().focus().children().removeClass("darkbg").each(function(){if(a==e(this).find("span").text())return void e(this).addClass("darkbg")}),e(this).find("#serach-icon1").removeClass("icon-list-down1").addClass("icon-list-up1")}else e(this).find("ul").hide(),e(this).find("#serach-icon1").removeClass("icon-list-up1").addClass("icon-list-down1")}),e("body").on("click",".serach-box1 ul li",function(t){t.stopPropagation();var a=e(this).attr("data-start"),i=e(this).attr("data-end"),n=(e(this).attr("data-weeks"),e(this).parents(".serach-box1").find(".choose-value1")),s=e(this).children("span").text();if(n.attr("data-id",e(this).attr("data-id")),e(this).parent().hide().parent().find("#serach-icon1").removeClass("icon-list-up1").addClass("icon-list-down1"),e(this).siblings().removeClass("darkbg").end().addClass("darkbg"),s!==e(".choose-value1").text()){e(".choose-value1").text(s);var r=e(this).attr("data-id");e(".tap_slide_main1").text(ge.callStr.TimeList[r]),a=String(a).split("."),i=String(i).split(".");var a=new Date(a[0],a[1]-1,a[2]).getTime(),i=new Date(i[0],i[1]-1,i[2]).getTime();thatTimeBoth=[a,i];var r=ie(a,i);ge={callStr:b(r[0],r[1])},x(),ne(new Date),ee()}}),e(document).click(function(){e("#choose-ul").hide(),e("#choose-ul0").hide(),e("#choose-ul1").hide(),e("#serach-icon").addClass("icon-list-down").removeClass("icon-list-up"),e("#serach-icon0").addClass("icon-list-down0").removeClass("icon-list-up0"),e("#serach-icon1").addClass("icon-list-down1").removeClass("icon-list-up1")});!function(){var t=JCenterHomeHost+"backlogs/apps";e.getJSON(t,function(t){var a="";t.data&&t.data.length>0&&(e.each(t.data,function(e){a+="<li data-id='"+t.data[e].id+"'><span>"+t.data[e].name+"</span></li>"}),e("#choose-ul0").append(a))})}(),ne((new Date).getTime()),e(".left_slide").click(function(t){t.preventDefault();var a=e(".tap_slide_main").html(),a=ge.callStr.TimeList.indexOf(a);if(!(a>0))return!1;T(a,-1),ee(),Q()}),e(".right_slide").click(function(t){t.preventDefault();var a=e(".tap_slide_main").html(),a=ge.callStr.TimeList.indexOf(a);if(!(a<ge.callStr.TimeList.length-1))return!1;T(a,1),ee(),Q()});var _e={backlog_JY:"jy",backlog_BKDS:"res",backlog_ZY:"zy"};e("body").on("click",".a_title",function(t){if("backlog_ZY"==e(this).parents("li").attr("flag")){var a=e(this).attr("data-account");p.init(null,null,null,a)}else{var i=e(this).attr("data-href");window.open(i)}}),S(e("#serach-box .choose-value").attr("data-id"));var we=[];J("0"),e("body").delegate(".prev_btn a","click",function(){M(Number(me.pageno)-1)}),e("body").delegate(".next_btn a","click",function(){M(Number(me.pageno)+1)}),e("body").delegate(".li_start","click",function(){M(e(this).attr("data-start"))}),e(".app_slide_top").delegate(".edit_img","click",function(){A()}),e(".select_child").change(function(){$id=e(".select_child option:selected").attr("id"),O(e("#todo_ul"),"todo_ul_add",$id)}),e(".change_week_kind p").click(function(){e(".change_week_kind p").removeClass("act"),e(this).addClass("act")}),function(){e(".submit_bnt").click(function(t){t.preventDefault(),e(".wrapper").show(),e(".ok_update").hide(),localStorage.tarGet,localStorage.clear("tarGet");var a=e(".form_week").serializeArray(),i={};i.type=e(".change_week_kind .act").attr("data-isz");for(var n=0;n<a.length;n++)i[a[n].name]=a[n].value;i.start=G(i.weekDay,i.start),i.end=G(i.weekDay,i.end),i.userId=pe.data.uid,i.schoolId=pe.data.orgid,i.author=pe.data.username,le(i)&&(se(i,"add"),ce())})}(),e(".app_slide_top li").click(function(t){t.preventDefault();var a=e(this).children("a").attr("href"),a=a.replace(/#/,"");e(".app_slide_top li").removeClass("act"),e(this).toggleClass("act"),e(".app_slide_ul").find(".acta").removeClass("acta"),e(e(".app_slide_ul").children("li")[a]).addClass("acta"),"#2"==e(".app_slide_top .act").find("a").attr("href")&&(e(".app_top").hide(),e(".app_top0").hide(),e(".app_table").addClass("border_none"),O(e("#todo_ul"),"todo_ul_add")),"#1"==e(".app_slide_top .act").find("a").attr("href")&&(e(".app_top").show(),e(".select_child").hide(),e(".edit_img").css("display","none"),e(".app_table").removeClass("border_none"),e(".app_top0").hide(),!1===pe.isAddWeek&&ae("未添加学年信息，请联系后台管理员添加学年信息",3e3)),"#0"==e(".app_slide_top .act").find("a").attr("href")&&(e(".app_top0").show(),e(".app_top").hide(),e(".select_child").hide(),e(".edit_img").css("display","none"),e(".app_table").removeClass("border_none"))}),jQuery(function(){function t(t){""!==t&&localStorage.setItem("setTime",t),""==t?e("#laydateWeekDay").attr("placeholder",localStorage.setTime):e("#laydateWeekDay").attr("placeholder",t)}function a(e,t){if(1==arguments.length){var a=e.split("-");return new Array("星期日","星期一","星期二","星期三","星期四","星期五","星期六")[new Date(a[0],a[1]-1,a[2]).getDay()]}var a=e.slice(-8,-3).replace(/:/,"：");return a}function i(t,a){var a=a.slice(0,-3);e(t).val(a)}200!=pe.data.ptUsertype&&201!=pe.data.ptUsertype||e(".app_slide_top li:last-child").hide(),e("#laydate_clear").click(function(){e("#laydateWeekDay").attr("placeholder",""),e("#laydateWeekDay").val("")}),e("#laydateWeekDay").click(function(){var a=e("#laydateWeekDay").val();e("#laydateWeekDay").val(""),t(a)}),function(){e(".week_laydate_icon")[0].addEventListener("click",function(a){var i=e("#laydateWeekDay").val();e("#laydateWeekDay").trigger("click"),t(i)}),e(".week_laydate_icon")[1].addEventListener("click",function(t){e("#appTimeStart1").trigger("click")}),e(".week_laydate_icon")[2].addEventListener("click",function(t){e("#appTimeEnd2").trigger("click")})}(),e(".active-add").click(function(t){if(he.family==pe.data.ptUsertype)return void ae("家长只能查看周历");var a=e(this).parent().parent(),i=e(".tap_slide_main").html().split("/")[0].slice(-4),n=e(a).find(".week-box p:first-child").text().slice(0,2)-1,s=e(a).find(".msg-box .week-date").html();if(new Date(i,n,s).getTime()<(new Date).getTime()-864e5)return void ae("不能在当前时间之前添加或改动！");var r=e(t.target).parent().parent().attr("class").replace(/week/,"").trim();localStorage.setItem("tarGet",r),e(".add_week_wrapper .add_week_title p").text("添加周历"),pe.thisDate=e(t.target).parent().parent(),pe.thisDate=$(pe.thisDate),e("#laydateWeekDay").val(pe.thisDate),de(t),e(".wrapper").show(),e(".ok_update").hide()}),e(".clear_btn").click(function(t){e(".laydate_week_wrapper input").val("00:00"),e(".form_week .week_event input").val(""),e(".act[data-isz=2]")&&(e("p[data-isz=1]").addClass("act"),e("p[data-isz=2]").removeClass("act")),t.preventDefault(),ce()}),e("#laydateWeekDay").jeDate({isinitVal:!1,minDate:e.nowDate({DD:0}),maxDate:"2030-06-16 23:59:59",format:"YYYY-MM-DD",zIndex:3e3,choosefun:function(t){e("#laydateWeekDay").val(a(t.context.value)+" （"+t.context.value+"）")},okfun:function(t){e("#laydateWeekDay").val(a(t.context.value)+" （"+t.context.value+"）")}}),e("#appTimeStart1").jeDate({isinitVal:!1,minDate:"2016-06-16 23:59:59",maxDate:e.nowDate({DD:0}),format:"hh:mm:00",zIndex:3e3,okfun:function(e){i(e.context,e.context.value)},success:function(){e(".jedatehmstitle").siblings()[2].remove(),e(".jedatepropseconds").remove(),e(".jedateproptext").css({margin:"0 18px",width:"80px"}),e(".jedatehmscon ").css({margin:"0 18px",width:"80px"})}}),e("#appTimeEnd2").jeDate({isinitVal:!1,minDate:"2016-06-16 23:59:59",maxDate:e.nowDate({DD:0}),format:"hh:mm:00",zIndex:3e3,okfun:function(e){i(e.context,e.context.value)},success:function(){e(".jedatehmstitle").siblings()[2].remove(),e(".jedatepropseconds").remove(),e(".jedateproptext").css({margin:"0 18px",width:"80px"}),e(".jedatehmscon ").css({margin:"0 18px",width:"80px"})}})})});