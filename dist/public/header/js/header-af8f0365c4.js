"use strict";define(["jquery","service","orgConfig","tools","template","addFav","appVerify"],function(e,a,t,o,n,r,i){function s(){var e=window.location.href;e.indexOf("#page")&&(e=e.split("#page")[0]),window.location.href=a.prefix+"/login?redirectUrl="+e}function l(){e.ajax({url:a.prefix+"/logout",type:"GET",dataType:"jsonp",jsonp:"callback",success:function(e){window.location.href.indexOf("persCenter")?window.location.href=a.htmlHost+"/dist/platform/www/home/index.html":window.location.reload()},error:function(){window.location.href.indexOf("persCenter")?window.location.href=a.htmlHost+"/dist/platform/www/home/index.html":window.location.reload()}})}function c(t){e.ajax({url:a.activityHost+"/authority/anonymous/getAuthority?userId="+t,type:"GET",dataType:"jsonp",jsonp:"callbackuser",success:function(e){u=e.data.roleId},error:function(e){layer.alert("服务器异常",{icon:0})}})}var d=null,p=null,u="";!function(){var t=[{id:"1",name:"首页",url:a.htmlHost+"/dist/platform/www/home/index.html",newOpen:!1},{id:"2",name:"新闻",url:a.htmlHost+"/dist/platform/www/news/sitenewsListInCategory.html",newOpen:!1},{id:"3",name:"资源",url:"",childNav:[{id:"31",name:"本地资源",url:"javascript:void(0)",newOpen:!1,type:"resources_appId"},{id:"32",name:"在线资源",url:a.sourcePlatformBase+"/syncTeaching/index?requireLogin=false",newOpen:!1}]},{id:"7",name:"视频",url:"javascript:void(0)",type:"video",newOpen:!1},{id:"6",name:"教研",url:"javascript:void(0)",newOpen:!1,type:"teachingresearch_appId"},{id:"4",name:"活动",url:"javascript:void(0)",newOpen:!1,type:"activityId"},{id:"5",name:"社区",url:a.newSpaceBase+"/JCenterHome/www/interspace/interspace.html",newOpen:!1}],o={navList:t};e("#nav .nav_bottom ul").html(n("navList",o))}(),function(t,r,i){var s=a.htmlHost+"/pf/api/schshow/orgs";i&&(s+="?areaId="+i),e.ajax({url:s,type:"GET",success:function(a){a&&"success"==a.code?a.data&&a.data.length>0&&(e.each(a.data,function(e){a.data[e].showName=o.hideTextByLen(a.data[e].name,10)}),p=a.data,t.html(n(r,a))):layer.alert(a.msg,{icon:0})},error:function(e){layer.alert("获取学校信息异常。",{icon:0})}})}(e("#schoolList"),"school_list",t.orgIds.baiyinAreaId),function(){var t={mySpace:a.newSpaceBase+"/home?requireLogin=true",myApp:a.htmlHost+"/dist/platform/www/app/app.html",personCenter:a.htmlHost+"/dist/platform/www/persCenter/persCenter.html",spaceManager:a.newSpaceBase+"/home?requireLogin=true",managerCenter:a.newSpaceBase+"/JCenterHome/persCenter/manageCen.html?spaceId=cdf26851780d41029fa149ec3f21c4df&spaceType=school",adminManager:a.adminManager};localStorage.userInfo?d=localStorage.userInfo:e.ajax({url:a.prefix+"/pf/api/header/user.jsonp",type:"GET",dataType:"jsonp",jsonp:"callback",success:function(a){"success"==a.result.code?(d=a.result.data,e("#reviewEnter").length>0&&c(d.id)):"login_error"==a.code&&console.log("用户没有登录"),a.result.userJumpHref=t,e("#login_message").append(n("loginMessage",{data:a.result}))}})}();var w=window.location.href.split("/")[window.location.href.split("/").length-1],h=window.location.href.split("/")[window.location.href.split("/").length-2];return"index.html"==w&&"home"==h?e(".chooseArea").show():e(".chooseArea").hide(),e("body").delegate("#login_message .loginButton","click",function(){s()}),e("body").delegate(".logout","click",function(){l()}),e("body").delegate("#login_message .userName>span , .chooseArea .area , .resourceNav>a","click",function(a){a.stopPropagation();var t=e(this).find("span.arrow");t.hasClass("arrowUp")?(t.addClass("arrowDown").removeClass("arrowUp"),e(this).parent().find(".chooseList").hide()):(t.addClass("arrowUp").removeClass("arrowDown"),e(this).parent().find(".chooseList").show())}),e(document).click(function(){e("span.arrow").removeClass("arrowUp").addClass("arrowDown"),e(".chooseList").hide()}),e("body").delegate("#nav .verify_app_enter","click",function(){if("activityId"==e(this).attr("type"))e.ajax({url:a.activityHost+"/anonymous/activityIndex",type:"GET",dataType:"jsonp",jsonp:"callback",success:function(e){"success"==e.code?window.location.href=a.activityHost+e.data+(d?"?login=true":"?login=false"):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("服务器异常",{icon:0})}});else if("teachingresearch_appId"==e(this).attr("type"))d?i.verifyApp(a.appIds[e(this).attr("type")],"2","","about:self"):window.location.href=a.htmlHost+"/dist/platform/www/jy/jy.html";else if("video"==e(this).attr("type")){if(!d)return void layer.alert("请登录后操作。",{icon:0});i.verifyApp(a.appIds.hanbovideo_appId,"2","","about:self")}}),e("body").delegate("#nav .list a","click",function(){e(this).parents(".resource").siblings().addClass("nav_act"),"resources_appId"==e(this).attr("type")&&(window.location.href=d?a.sourceSystemBase+"/apps.do":a.htmlHost+"/dist/platform/www/resources/resources.html")}),window.mes={getUser:function(){return d},getSchoolList:function(){return p},getUserRole:function(){return u}}});