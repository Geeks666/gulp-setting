"use strict";define(["jquery","service","template"],function(e,a,n){function o(n,o){var t=window;"2"==o&&(t=window.open("about:blank")),e.support.cors=!0,e.ajax({url:a.prefix+"/pf/api/app/verifyJp.jsonp",type:"get",data:{appId:n},dataType:"jsonp",jsonp:"callback",success:function(e){e=e.result,"success"==e.code?t.location.href=e.data:"failed"==e.code&&("2"==o&&t.close(),layer.alert(e.msg,{icon:0}))},error:function(e){layer.alert("请求失败",{icon:0})}})}function t(){var e=window.location.href;e.indexOf("#page")&&(e=e.split("#page")[0]),window.location.href=a.prefix+"/login?redirectUrl="+e}function i(){e.getJSON(a.OAHost+"/logout"),e.ajax({url:a.prefix+"/logout",type:"GET",dataType:"jsonp",jsonp:"callback",success:function(e){-1!=window.location.href.indexOf("persCenter")?window.location.href=a.htmlHost+"/dist/platform/www/home/index.html":window.location.reload()},error:function(){-1!=window.location.href.indexOf("persCenter")?window.location.href=a.htmlHost+"/dist/platform/www/home/index.html":window.location.reload()}})}var r=null;return function(){var o=[{id:"1",name:"首页",url:a.prefix+"/dist/platform/www/home/index.html",iconurl:a.prefix+"/dist/public/header/images/index-66d37a201e.png",newOpen:!1},{id:"2",name:"资源",url:a.sourcePlatformBase+"?requireLogin=false",iconurl:a.htmlHost+"/dist/public/header/images/resource-be94a25e9a.png",newOpen:!0},{id:"3",name:"应用",url:a.prefix+"/dist/platform/www/app/application.html",iconurl:a.htmlHost+"/dist/public/header/images/app-78d5ef7327.png",newOpen:!1},{id:"4",name:"空间",url:a.newSpaceBase+"/JCenterHome/www/interspace/interspace.html",iconurl:a.htmlHost+"/dist/public/header/images/space-de51dfaae7.png",newOpen:!1},{id:"5",name:"活动",url:"javascript:void(0);",iconurl:"",newOpen:!1,class:"activity"},{id:"6",name:"数据",url:"javascript:void(0);",iconurl:"",newOpen:!1,class:"statistics-header"}];e("#nav").html(n("navList",{navList:o}))}(),function(){var o={mySpace:a.newSpaceBase+"/home?requireLogin=true",myApp:a.prefix+"/dist/platform/www/persCenter/persApp.html",personCenter:a.prefix+"/dist/platform/www/persCenter/persCenter.html",spaceManager:a.newSpaceBase+"/home?requireLogin=true",managerCenter:a.newSpaceBase+"/JCenterHome/persCenter/manageCen.html?spaceId=cdf26851780d41029fa149ec3f21c4df&spaceType=school",adminManager:a.adminManager};localStorage.userInfo?r=localStorage.userInfo:e.ajax({url:a.prefix+"/pf/api/header/user.jsonp",type:"GET",dataType:"jsonp",jsonp:"callback",success:function(t){"success"==t.result.code?(r=t.result.data,e.ajax({type:"get",dataType:"jsonp",url:a.prefix+"pf/api/information/list.jsonp",success:function(a){console.log(a),a.data.datalist.length>0&&e.each(a.data.datalist,function(a,n){0==n.isRead&&(e(".message-warn").addClass("has-notread"),e(".message-warn").addClass("noread"))})},error:function(){}})):"login_error"==t.code&&console.log("用户没有登录"),t.result.userJumpHref=o,e("#login_message").html(n("loginMessage",{data:t.result}))}})}(),e("#mainbo-top-nav").on("click",".activity",function(){var n=window.open("about:blank");e.support.cors=!0,e.ajax({url:a.activityHost+"/anonymous/activityIndex",type:"GET",dataType:"jsonp",jsonp:"callback",success:function(e){"success"==e.code?n.location.href=a.activityHost+e.data+(r?"?login=true":"?login=false"):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("服务器异常",{icon:0})}})}),e("#mainbo-top-nav").on("click",".statistics-header",function(){if(!r)return layer.alert("请登录后操作。",{icon:0}),!1;o("b5176e330028457fa78289d6e63eca2f","2")}),e("body").delegate(".mainbo-top-nav .loginButton","click",function(){t()}),e("body").delegate(".logout","click",function(){i()}),e("body").delegate(".login_user .login_username","click",function(a){a.stopPropagation();var n=e(this).find("span.arrow");n.hasClass("arrow_up")?(n.removeClass("arrow_up"),e(this).parents(".login_user").find("ul").hide()):(n.addClass("arrow_up"),e(this).parents(".login_user").find("ul").show())}),e(document).click(function(){e(".login_user").find("span.arrow").removeClass("arrow_up"),e(".login_user").find("ul").hide()}),e("body").delegate(".message-warn","click",function(){window.location.href=a.prefix+"/dist/platform/www/message/message.html"}),window.mes={getUser:function(){return r},verifyApp:o}});