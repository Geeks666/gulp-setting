'use strict';

require.config({
  baseUrl: '../',
  paths: {
    'platformConf': 'public/js/platformConf-541e3fb1ce.js'
  }
});
require(['platformConf'], function (configpaths) {
  require.config(configpaths);

  define('', ['jquery', 'template', 'service', 'footer', 'header', 'layer', 'page', 'jqueryUIB'], function ($, template, service, footer, header, layer, Page, jqueryUIB) {
    // $.getJSON(service.htmlHost + 'pf/api/information/list', function (result) {
    //    console.log(result)
    //  })
    var pageSize = 10;
    var currentPage = 1;

    getMessageList(currentPage, '');

    function getMessageList(currentPage, isPaging, appName) {
      var data = {
        'page.currentPage': currentPage,
        'page.pageSize': pageSize
      };
      if (!!appName && appName != '请选择') {
        data.appName = appName;
      }
      $.ajax({
        type: "get",
        url: service.htmlHost + 'pf/api/information/list.jsonp',
        dataType: 'jsonp',
        jsonp: "callback",
        data: data,
        cache: false,
        success: function success(data) {
          var dataList = data.data.datalist;
          $('.message-list').html('');
          $.each(dataList, function (i, d) {
            var $listItem = $("<li>");
            if (d.isRead) {
              $listItem.addClass('read');
            } else {
              $listItem.addClass('not-read');
            }
            var $check = $('<div>');
            $check.addClass('form-check-box fl');
            $check.html('<div class="form-check"><span></span></div>');
            $check.find('.form-check').attr('data-id', d.id);
            $check.click(function (e) {
              if ($(this).find('.form-check').hasClass('checked')) {
                $(this).find('.form-check').removeClass('checked');
              } else {
                $(this).find('.form-check').addClass('checked');
              }
            });
            var $oA = $('<a>');
            $oA.click(function () {
              var id = d.id;
              clickMessage(id, d.url, d.appName, currentPage, appName);
              $listItem.attr('class', 'read');
            });
            var conStr = '<div class="mes-con' + ' fl"><span' + ' class="mr8">[' + d.appName + ']</span><span>' + d.title + '</span></div><span class="mes-date fr">' + d.sendDate + '</span>';

            $listItem.html($check);
            $oA.html(conStr);
            $listItem.append($oA);
            $('.message-list').append($listItem);
          });

          if (!isPaging) {
            $('#page').html('');
          }
          if (data['data']['totalPages'] > 1 && !isPaging) {
            renderPage('page', data['data']['totalCount'], appName, currentPage);
          }
        },
        error: function error(XMLHttpRequest, textStatus, errorThrown) {
          console.log(textStatus);
        }
      });
    }

    function jsoncallbackaa(data) {
      alert(data.status);
    }

    //翻页
    function renderPage(domId, total, appName, currentPage) {
      var p = new Page();
      p.init({
        target: '#' + domId,
        pagesize: pageSize,
        pageCount: 8,
        current: currentPage ? currentPage : 1,
        count: total,
        callback: function callback(current) {
          getMessageList(current, true, appName);
        }
      });
    }

    //checkebox
    $('.form-check').click(function () {
      if ($(this).hasClass('checked')) {
        if ($(this).hasClass('all')) {
          $('.form-check').removeClass('checked');
        } else {
          $(this).removeClass('checked');
        }
      } else {
        if ($(this).hasClass('all')) {
          $('.form-check').addClass('checked');
        } else {
          $(this).addClass('checked');
        }
      }
    });

    //删除请求
    function deleteMessage(ids) {
      if (ids.length > 0) {
        layer.confirm('您确定要删除这些消息么？', function () {
          layer.closeAll();
          $.ajax({
            type: "get",
            url: service.htmlHost + 'pf/api/information/delete',
            dataType: 'json',
            data: {
              ids: ids.join(',')
            },
            success: function success(data) {
              if (data.code == "success") {
                getMessageList(currentPage, '', $('.form-app .type').html());
              }
            },
            error: function error(data) {}
          });
        });
      } else {
        layer.alert('您还没有选中的信息!!!');
      }
    }

    //删除
    $('.btn-del').click(function () {
      var ids = [];
      $('.message-list .checked').each(function (i, d) {
        ids.push($(this).attr('data-id'));
      });
      deleteMessage(ids);
    });

    //已读请求
    function readMessage(ids) {
      if (ids.length > 0) {
        $.ajax({
          type: "get",
          url: service.htmlHost + 'pf/api/information/mark',
          dataType: 'json',
          cache: false,
          data: {
            ids: ids.join(',')
          },
          success: function success(data) {
            if (data.code == 'success') {
              layer.msg('已标记为已读');
              setTimeout(function () {
                layer.closeAll();
              }, 1000);
              $('.checked').parents('.not-read').attr('class', 'read');
            }
          }
        });
      } else {
        layer.alert('您还没有选中的消息!!!');
      }
    }

    function clickMessage(id, url, selfappName, currentPage, searchappName) {
      if (selfappName != "人人通") {
        var url = service.htmlHost + 'pf/api/information/view/' + id;
        window.open(url, '_blank');
      } else {
        var url = service.htmlHost + 'pf/api/information/mark?ids=' + id;
        $.ajax({
          type: 'get',
          url: url,
          dataType: 'json',
          cache: false,
          success: function success(data) {
            if (data.code == 'success') {
              getMessageList(currentPage, '', searchappName);
            }
          }
        });
      }
    }

    //标记为已读
    $('.btn-read').click(function () {
      var ids = [];
      $('.message-list .checked').each(function (i, d) {
        ids.push($(this).attr('data-id'));
      });
      readMessage(ids);
    });
    /*
    * 应用名称下拉选项*/
    $.ajax({
      type: "get",
      url: service.htmlHost + 'pf/api/information/getAppType',
      dataType: 'json',
      cache: false,
      success: function success(data) {
        var appStr = '<li><p class="select" title="请选择" data-id="">请选择</p></li>';
        $.each(data.data, function (index, datas) {
          appStr += '<li><p class="select">' + datas.appName + '</p></li>';
        });
        $('.form-app .types').html(appStr);
        $('.form-app .type').html('请选择');
        mbSelect();
      },
      error: function error(data) {
        // JCenterHelper.errorHandle(data);
      }
    });

    function mbSelect() {
      //选择项 隐藏下拉框
      $(".form-select").on("click", function (e) {
        var e = e || window.event;
        var tar = e.target || e.srcElement;
        if ($(tar).hasClass('select')) {
          $(".types").hide();
          $(tar).parents('.form-select').find('.type').html($(tar).html());
          if ($(tar).parents('.form-select').find('.type').html() == '请选择') {
            getMessageList(currentPage, '', '');
          } else {
            getMessageList(currentPage, '', $(tar).parents('.form-select').find('.type').html());
          }
        }
        if ($(tar).hasClass('type')) {
          if ($(tar).parent().find(".types").css('display') == 'none') {
            $(".types").hide();
            $(tar).parent().find(".types").show();
          } else {
            $(tar).parent().find(".types").hide();
          }
        }
      });
      //点击下空白处，下拉框消失
      $(document).on("click", function (e) {
        var e = e || window.event;
        var tar = e.target || e.srcElement;
        $(".types").hide();
      });
      //阻止冒泡
      $(".form-select").click(function (e) {
        // e.stopPropagation();
        return false;
      });
    }
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lc3NhZ2UvanMvbWVzc2FnZS5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiY29uZmlnIiwiYmFzZVVybCIsInBhdGhzIiwiY29uZmlncGF0aHMiLCJkZWZpbmUiLCIkIiwidGVtcGxhdGUiLCJzZXJ2aWNlIiwiZm9vdGVyIiwiaGVhZGVyIiwibGF5ZXIiLCJQYWdlIiwianF1ZXJ5VUlCIiwicGFnZVNpemUiLCJjdXJyZW50UGFnZSIsImdldE1lc3NhZ2VMaXN0IiwiaXNQYWdpbmciLCJhcHBOYW1lIiwiZGF0YSIsImFqYXgiLCJ0eXBlIiwidXJsIiwiaHRtbEhvc3QiLCJkYXRhVHlwZSIsImpzb25wIiwiY2FjaGUiLCJzdWNjZXNzIiwiZGF0YUxpc3QiLCJkYXRhbGlzdCIsImh0bWwiLCJlYWNoIiwiaSIsImQiLCIkbGlzdEl0ZW0iLCJpc1JlYWQiLCJhZGRDbGFzcyIsIiRjaGVjayIsImZpbmQiLCJhdHRyIiwiaWQiLCJjbGljayIsImUiLCJoYXNDbGFzcyIsInJlbW92ZUNsYXNzIiwiJG9BIiwiY2xpY2tNZXNzYWdlIiwiY29uU3RyIiwidGl0bGUiLCJzZW5kRGF0ZSIsImFwcGVuZCIsInJlbmRlclBhZ2UiLCJlcnJvciIsIlhNTEh0dHBSZXF1ZXN0IiwidGV4dFN0YXR1cyIsImVycm9yVGhyb3duIiwiY29uc29sZSIsImxvZyIsImpzb25jYWxsYmFja2FhIiwiYWxlcnQiLCJzdGF0dXMiLCJkb21JZCIsInRvdGFsIiwicCIsImluaXQiLCJ0YXJnZXQiLCJwYWdlc2l6ZSIsInBhZ2VDb3VudCIsImN1cnJlbnQiLCJjb3VudCIsImNhbGxiYWNrIiwiZGVsZXRlTWVzc2FnZSIsImlkcyIsImxlbmd0aCIsImNvbmZpcm0iLCJjbG9zZUFsbCIsImpvaW4iLCJjb2RlIiwicHVzaCIsInJlYWRNZXNzYWdlIiwibXNnIiwic2V0VGltZW91dCIsInBhcmVudHMiLCJzZWxmYXBwTmFtZSIsInNlYXJjaGFwcE5hbWUiLCJ3aW5kb3ciLCJvcGVuIiwiYXBwU3RyIiwiaW5kZXgiLCJkYXRhcyIsIm1iU2VsZWN0Iiwib24iLCJldmVudCIsInRhciIsInNyY0VsZW1lbnQiLCJoaWRlIiwicGFyZW50IiwiY3NzIiwic2hvdyIsImRvY3VtZW50Il0sIm1hcHBpbmdzIjoiOztBQUFBQSxRQUFRQyxNQUFSLENBQWU7QUFDYkMsV0FBUyxLQURJO0FBRWJDLFNBQU87QUFDTCxvQkFBZ0I7QUFEWDtBQUZNLENBQWY7QUFNQUgsUUFBUSxDQUFDLGNBQUQsQ0FBUixFQUEwQixVQUFVSSxXQUFWLEVBQXVCO0FBQy9DSixVQUFRQyxNQUFSLENBQWVHLFdBQWY7O0FBRUFDLFNBQU8sRUFBUCxFQUFVLENBQUMsUUFBRCxFQUFXLFVBQVgsRUFBdUIsU0FBdkIsRUFBa0MsUUFBbEMsRUFBNEMsUUFBNUMsRUFBc0QsT0FBdEQsRUFBK0QsTUFBL0QsRUFBc0UsV0FBdEUsQ0FBVixFQUNFLFVBQVVDLENBQVYsRUFBYUMsUUFBYixFQUF1QkMsT0FBdkIsRUFBZ0NDLE1BQWhDLEVBQXdDQyxNQUF4QyxFQUFnREMsS0FBaEQsRUFBdURDLElBQXZELEVBQTREQyxTQUE1RCxFQUF1RTtBQUNyRTtBQUNBO0FBQ0E7QUFDQSxRQUFJQyxXQUFXLEVBQWY7QUFDQSxRQUFJQyxjQUFjLENBQWxCOztBQUVBQyxtQkFBZUQsV0FBZixFQUE0QixFQUE1Qjs7QUFFQSxhQUFTQyxjQUFULENBQXdCRCxXQUF4QixFQUFxQ0UsUUFBckMsRUFBK0NDLE9BQS9DLEVBQXdEO0FBQ3RELFVBQUlDLE9BQU87QUFDVCw0QkFBb0JKLFdBRFg7QUFFVCx5QkFBaUJEO0FBRlIsT0FBWDtBQUlBLFVBQUksQ0FBQyxDQUFDSSxPQUFGLElBQWFBLFdBQVcsS0FBNUIsRUFBbUM7QUFDakNDLGFBQUtELE9BQUwsR0FBZUEsT0FBZjtBQUNEO0FBQ0RaLFFBQUVjLElBQUYsQ0FBTztBQUNMQyxjQUFNLEtBREQ7QUFFTEMsYUFBS2QsUUFBUWUsUUFBUixHQUFtQiwrQkFGbkI7QUFHTEMsa0JBQVUsT0FITDtBQUlMQyxlQUFPLFVBSkY7QUFL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RXVCLE1BQUYsSUFBWXZCLEVBQUVvRCxVQUF4QjtBQUNBeEYsVUFBRSxRQUFGLEVBQVl5RixJQUFaO0FBQ0QsT0FKRDtBQUtBO0FBQ0F6RixRQUFFLGNBQUYsRUFBa0JtQyxLQUFsQixDQUF3QixVQUFVQyxDQUFWLEVBQWE7QUFDbkM7QUFDQSxlQUFPLEtBQVA7QUFDRCxPQUhEO0FBSUQ7QUFDRixHQWhRSDtBQWlRRCxDQXBRRCIsImZpbGUiOiJtZXNzYWdlL2pzL21lc3NhZ2UtNGUxYjllYWJkNS5qcyIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUuY29uZmlnKHtcclxuICBiYXNlVXJsOiAnLi4vJyxcclxuICBwYXRoczoge1xyXG4gICAgJ3BsYXRmb3JtQ29uZic6ICdwdWJsaWMvanMvcGxhdGZvcm1Db25mLmpzJ1xyXG4gIH1cclxufSk7XHJcbnJlcXVpcmUoWydwbGF0Zm9ybUNvbmYnXSwgZnVuY3Rpb24gKGNvbmZpZ3BhdGhzKSB7XHJcbiAgcmVxdWlyZS5jb25maWcoY29uZmlncGF0aHMpO1xyXG5cclxuICBkZWZpbmUoJycsWydqcXVlcnknLCAndGVtcGxhdGUnLCAnc2VydmljZScsICdmb290ZXInLCAnaGVhZGVyJywgJ2xheWVyJywgJ3BhZ2UnLCdqcXVlcnlVSUInXSxcclxuICAgIGZ1bmN0aW9uICgkLCB0ZW1wbGF0ZSwgc2VydmljZSwgZm9vdGVyLCBoZWFkZXIsIGxheWVyLCBQYWdlLGpxdWVyeVVJQikge1xyXG4gICAgICAvLyAkLmdldEpTT04oc2VydmljZS5odG1sSG9zdCArICdwZi9hcGkvaW5mb3JtYXRpb24vbGlzdCcsIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgLy8gICAgY29uc29sZS5sb2cocmVzdWx0KVxyXG4gICAgICAvLyAgfSlcclxuICAgICAgdmFyIHBhZ2VTaXplID0gMTA7XHJcbiAgICAgIHZhciBjdXJyZW50UGFnZSA9IDE7XHJcblxyXG4gICAgICBnZXRNZXNzYWdlTGlzdChjdXJyZW50UGFnZSwgJycpO1xyXG5cclxuICAgICAgZnVuY3Rpb24gZ2V0TWVzc2FnZUxpc3QoY3VycmVudFBhZ2UsIGlzUGFnaW5nLCBhcHBOYW1lKSB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSB7XHJcbiAgICAgICAgICAncGFnZS5jdXJyZW50UGFnZSc6IGN1cnJlbnRQYWdlLFxyXG4gICAgICAgICAgJ3BhZ2UucGFnZVNpemUnOiBwYWdlU2l6ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKCEhYXBwTmFtZSAmJiBhcHBOYW1lICE9ICfor7fpgInmi6knKSB7XHJcbiAgICAgICAgICBkYXRhLmFwcE5hbWUgPSBhcHBOYW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgdHlwZTogXCJnZXRcIixcclxuICAgICAgICAgIHVybDogc2VydmljZS5odG1sSG9zdCArICdwZi9hcGkvaW5mb3JtYXRpb24vbGlzdC5qc29ucCcsXHJcbiAgICAgICAgICBkYXRhVHlwZTogJ2pzb25wJyxcclxuICAgICAgICAgIGpzb25wOiBcImNhbGxiYWNrXCIsXHJcbiAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgY2FjaGU6IGZhbHNlLFxyXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIGRhdGFMaXN0ID0gZGF0YS5kYXRhLmRhdGFsaXN0O1xyXG4gICAgICAgICAgICAkKCcubWVzc2FnZS1saXN0JykuaHRtbCgnJyk7XHJcbiAgICAgICAgICAgICQuZWFjaChkYXRhTGlzdCwgZnVuY3Rpb24gKGksIGQpIHtcclxuICAgICAgICAgICAgICB2YXIgJGxpc3RJdGVtID0gJChcIjxsaT5cIik7XHJcbiAgICAgICAgICAgICAgaWYgKGQuaXNSZWFkKSB7XHJcbiAgICAgICAgICAgICAgICAkbGlzdEl0ZW0uYWRkQ2xhc3MoJ3JlYWQnKTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxpc3RJdGVtLmFkZENsYXNzKCdub3QtcmVhZCcpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB2YXIgJGNoZWNrID0gJCgnPGRpdj4nKTtcclxuICAgICAgICAgICAgICAkY2hlY2suYWRkQ2xhc3MoJ2Zvcm0tY2hlY2stYm94IGZsJyk7XHJcbiAgICAgICAgICAgICAgJGNoZWNrLmh0bWwoJzxkaXYgY2xhc3M9XCJmb3JtLWNoZWNrXCI+PHNwYW4+PC9zcGFuPjwvZGl2PicpO1xyXG4gICAgICAgICAgICAgICRjaGVjay5maW5kKCcuZm9ybS1jaGVjaycpLmF0dHIoJ2RhdGEtaWQnLCBkLmlkKTtcclxuICAgICAgICAgICAgICAkY2hlY2suY2xpY2soZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmZpbmQoJy5mb3JtLWNoZWNrJykuaGFzQ2xhc3MoJ2NoZWNrZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5mb3JtLWNoZWNrJykucmVtb3ZlQ2xhc3MoJ2NoZWNrZWQnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgnLmZvcm0tY2hlY2snKS5hZGRDbGFzcygnY2hlY2tlZCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIHZhciAkb0EgPSAkKCc8YT4nKTtcclxuICAgICAgICAgICAgICAkb0EuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGlkID0gZC5pZDtcclxuICAgICAgICAgICAgICAgIGNsaWNrTWVzc2FnZShpZCwgZC51cmwsIGQuYXBwTmFtZSwgY3VycmVudFBhZ2UsIGFwcE5hbWUpO1xyXG4gICAgICAgICAgICAgICAgJGxpc3RJdGVtLmF0dHIoJ2NsYXNzJywgJ3JlYWQnKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB2YXIgY29uU3RyID0gJzxkaXYgY2xhc3M9XCJtZXMtY29uJyArXHJcbiAgICAgICAgICAgICAgICAnIGZsXCI+PHNwYW4nICtcclxuICAgICAgICAgICAgICAgICcgY2xhc3M9XCJtcjhcIj5bJyArIGQuYXBwTmFtZSArICddPC9zcGFuPjxzcGFuPicgKyBkLnRpdGxlICsgJzwvc3Bhbj48L2Rpdj48c3BhbiBjbGFzcz1cIm1lcy1kYXRlIGZyXCI+JyArIGQuc2VuZERhdGUgKyAnPC9zcGFuPic7XHJcblxyXG4gICAgICAgICAgICAgICRsaXN0SXRlbS5odG1sKCRjaGVjayk7XHJcbiAgICAgICAgICAgICAgJG9BLmh0bWwoY29uU3RyKTtcclxuICAgICAgICAgICAgICAkbGlzdEl0ZW0uYXBwZW5kKCRvQSk7XHJcbiAgICAgICAgICAgICAgJCgnLm1lc3NhZ2UtbGlzdCcpLmFwcGVuZCgkbGlzdEl0ZW0pO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgaWYgKCFpc1BhZ2luZykge1xyXG4gICAgICAgICAgICAgICQoJyNwYWdlJykuaHRtbCgnJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRhdGFbJ2RhdGEnXVsndG90YWxQYWdlcyddID4gMSAmJiAhaXNQYWdpbmcpIHtcclxuICAgICAgICAgICAgICByZW5kZXJQYWdlKCdwYWdlJywgZGF0YVsnZGF0YSddWyd0b3RhbENvdW50J10sIGFwcE5hbWUsIGN1cnJlbnRQYWdlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoWE1MSHR0cFJlcXVlc3QsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRleHRTdGF0dXMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGpzb25jYWxsYmFja2FhKGRhdGEpIHtcclxuICAgICAgICBhbGVydChkYXRhLnN0YXR1cyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8v57+76aG1XHJcbiAgICAgIGZ1bmN0aW9uIHJlbmRlclBhZ2UoZG9tSWQsIHRvdGFsLCBhcHBOYW1lLCBjdXJyZW50UGFnZSkge1xyXG4gICAgICAgIHZhciBwID0gbmV3IFBhZ2UoKTtcclxuICAgICAgICBwLmluaXQoe1xyXG4gICAgICAgICAgdGFyZ2V0OiAnIycgKyBkb21JZCxcclxuICAgICAgICAgIHBhZ2VzaXplOiBwYWdlU2l6ZSxcclxuICAgICAgICAgIHBhZ2VDb3VudDogOCxcclxuICAgICAgICAgIGN1cnJlbnQ6IGN1cnJlbnRQYWdlID8gY3VycmVudFBhZ2UgOiAxLFxyXG4gICAgICAgICAgY291bnQ6IHRvdGFsLFxyXG4gICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChjdXJyZW50KSB7XHJcbiAgICAgICAgICAgIGdldE1lc3NhZ2VMaXN0KGN1cnJlbnQsIHRydWUsIGFwcE5hbWUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvL2NoZWNrZWJveFxyXG4gICAgICAkKCcuZm9ybS1jaGVjaycpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnY2hlY2tlZCcpKSB7XHJcbiAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnYWxsJykpIHtcclxuICAgICAgICAgICAgJCgnLmZvcm0tY2hlY2snKS5yZW1vdmVDbGFzcygnY2hlY2tlZCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnY2hlY2tlZCcpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnYWxsJykpIHtcclxuICAgICAgICAgICAgJCgnLmZvcm0tY2hlY2snKS5hZGRDbGFzcygnY2hlY2tlZCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnY2hlY2tlZCcpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuXHJcbiAgICAgIC8v5Yig6Zmk6K+35rGCXHJcbiAgICAgIGZ1bmN0aW9uIGRlbGV0ZU1lc3NhZ2UoaWRzKSB7XHJcbiAgICAgICAgaWYgKGlkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBsYXllci5jb25maXJtKCfmgqjnoa7lrpropoHliKDpmaTov5nkupvmtojmga/kuYjvvJ8nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGxheWVyLmNsb3NlQWxsKCk7XHJcbiAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgdHlwZTogXCJnZXRcIixcclxuICAgICAgICAgICAgICB1cmw6IHNlcnZpY2UuaHRtbEhvc3QgKyAncGYvYXBpL2luZm9ybWF0aW9uL2RlbGV0ZScsXHJcbiAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBpZHM6IGlkcy5qb2luKCcsJylcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5jb2RlID09IFwic3VjY2Vzc1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgIGdldE1lc3NhZ2VMaXN0KGN1cnJlbnRQYWdlLCAnJywgJCgnLmZvcm0tYXBwIC50eXBlJykuaHRtbCgpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxheWVyLmFsZXJ0KCfmgqjov5jmsqHmnInpgInkuK3nmoTkv6Hmga8hISEnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8v5Yig6ZmkXHJcbiAgICAgICQoJy5idG4tZGVsJykuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBpZHMgPSBbXTtcclxuICAgICAgICAkKCcubWVzc2FnZS1saXN0IC5jaGVja2VkJykuZWFjaChmdW5jdGlvbiAoaSwgZCkge1xyXG4gICAgICAgICAgaWRzLnB1c2goJCh0aGlzKS5hdHRyKCdkYXRhLWlkJykpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgZGVsZXRlTWVzc2FnZShpZHMpO1xyXG4gICAgICB9KVxyXG5cclxuICAgICAgLy/lt7Lor7vor7fmsYJcclxuICAgICAgZnVuY3Rpb24gcmVhZE1lc3NhZ2UoaWRzKSB7XHJcbiAgICAgICAgaWYgKGlkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB0eXBlOiBcImdldFwiLFxyXG4gICAgICAgICAgICB1cmw6IHNlcnZpY2UuaHRtbEhvc3QgKyAncGYvYXBpL2luZm9ybWF0aW9uL21hcmsnLFxyXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgICAgICBjYWNoZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICBpZHM6IGlkcy5qb2luKCcsJylcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICBpZiAoZGF0YS5jb2RlID09ICdzdWNjZXNzJykge1xyXG4gICAgICAgICAgICAgICAgbGF5ZXIubXNnKCflt7LmoIforrDkuLrlt7Lor7snKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICBsYXllci5jbG9zZUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwMClcclxuICAgICAgICAgICAgICAgICQoJy5jaGVja2VkJykucGFyZW50cygnLm5vdC1yZWFkJykuYXR0cignY2xhc3MnLCAncmVhZCcpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbGF5ZXIuYWxlcnQoJ+aCqOi/mOayoeaciemAieS4reeahOa2iOaBryEhIScpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gY2xpY2tNZXNzYWdlKGlkLCB1cmwsIHNlbGZhcHBOYW1lLCBjdXJyZW50UGFnZSwgc2VhcmNoYXBwTmFtZSkge1xyXG4gICAgICAgIGlmIChzZWxmYXBwTmFtZSAhPSBcIuS6uuS6uumAmlwiKSB7XHJcbiAgICAgICAgICB2YXIgdXJsID0gc2VydmljZS5odG1sSG9zdCArICdwZi9hcGkvaW5mb3JtYXRpb24vdmlldy8nICsgaWQ7XHJcbiAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdmFyIHVybCA9IHNlcnZpY2UuaHRtbEhvc3QgKyAncGYvYXBpL2luZm9ybWF0aW9uL21hcms/aWRzPScgKyBpZDtcclxuICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHR5cGU6ICdnZXQnLFxyXG4gICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgIGlmIChkYXRhLmNvZGUgPT0gJ3N1Y2Nlc3MnKSB7XHJcbiAgICAgICAgICAgICAgICBnZXRNZXNzYWdlTGlzdChjdXJyZW50UGFnZSwgJycsIHNlYXJjaGFwcE5hbWUpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8v5qCH6K6w5Li65bey6K+7XHJcbiAgICAgICQoJy5idG4tcmVhZCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaWRzID0gW107XHJcbiAgICAgICAgJCgnLm1lc3NhZ2UtbGlzdCAuY2hlY2tlZCcpLmVhY2goZnVuY3Rpb24gKGksIGQpIHtcclxuICAgICAgICAgIGlkcy5wdXNoKCQodGhpcykuYXR0cignZGF0YS1pZCcpKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIHJlYWRNZXNzYWdlKGlkcyk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC8qXHJcbiAgKiDlupTnlKjlkI3np7DkuIvmi4npgInpobkqL1xyXG4gICAgICAkLmFqYXgoe1xyXG4gICAgICAgIHR5cGU6IFwiZ2V0XCIsXHJcbiAgICAgICAgdXJsOiBzZXJ2aWNlLmh0bWxIb3N0ICsgJ3BmL2FwaS9pbmZvcm1hdGlvbi9nZXRBcHBUeXBlJyxcclxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgIGNhY2hlOiBmYWxzZSxcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgdmFyIGFwcFN0ciA9ICc8bGk+PHAgY2xhc3M9XCJzZWxlY3RcIiB0aXRsZT1cIuivt+mAieaLqVwiIGRhdGEtaWQ9XCJcIj7or7fpgInmi6k8L3A+PC9saT4nO1xyXG4gICAgICAgICAgJC5lYWNoKGRhdGEuZGF0YSwgZnVuY3Rpb24gKGluZGV4LCBkYXRhcykge1xyXG4gICAgICAgICAgICBhcHBTdHIgKz0gJzxsaT48cCBjbGFzcz1cInNlbGVjdFwiPicgKyBkYXRhcy5hcHBOYW1lICsgJzwvcD48L2xpPic7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgICQoJy5mb3JtLWFwcCAudHlwZXMnKS5odG1sKGFwcFN0cik7XHJcbiAgICAgICAgICAkKCcuZm9ybS1hcHAgLnR5cGUnKS5odG1sKCfor7fpgInmi6knKTtcclxuICAgICAgICAgIG1iU2VsZWN0KCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgIC8vIEpDZW50ZXJIZWxwZXIuZXJyb3JIYW5kbGUoZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGZ1bmN0aW9uIG1iU2VsZWN0KCkge1xyXG4gICAgICAgIC8v6YCJ5oup6aG5IOmakOiXj+S4i+aLieahhlxyXG4gICAgICAgICQoXCIuZm9ybS1zZWxlY3RcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgdmFyIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcclxuICAgICAgICAgIHZhciB0YXIgPSBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQ7XHJcbiAgICAgICAgICBpZiAoJCh0YXIpLmhhc0NsYXNzKCdzZWxlY3QnKSkge1xyXG4gICAgICAgICAgICAkKFwiLnR5cGVzXCIpLmhpZGUoKTtcclxuICAgICAgICAgICAgJCh0YXIpLnBhcmVudHMoJy5mb3JtLXNlbGVjdCcpLmZpbmQoJy50eXBlJykuaHRtbCgkKHRhcikuaHRtbCgpKTtcclxuICAgICAgICAgICAgaWYgKCQodGFyKS5wYXJlbnRzKCcuZm9ybS1zZWxlY3QnKS5maW5kKCcudHlwZScpLmh0bWwoKSA9PSAn6K+36YCJ5oupJykge1xyXG4gICAgICAgICAgICAgIGdldE1lc3NhZ2VMaXN0KGN1cnJlbnRQYWdlLCAnJywgJycpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGdldE1lc3NhZ2VMaXN0KGN1cnJlbnRQYWdlLCAnJywgJCh0YXIpLnBhcmVudHMoJy5mb3JtLXNlbGVjdCcpLmZpbmQoJy50eXBlJykuaHRtbCgpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKCQodGFyKS5oYXNDbGFzcygndHlwZScpKSB7XHJcbiAgICAgICAgICAgIGlmICgkKHRhcikucGFyZW50KCkuZmluZChcIi50eXBlc1wiKS5jc3MoJ2Rpc3BsYXknKSA9PSAnbm9uZScpIHtcclxuICAgICAgICAgICAgICAkKFwiLnR5cGVzXCIpLmhpZGUoKTtcclxuICAgICAgICAgICAgICAkKHRhcikucGFyZW50KCkuZmluZChcIi50eXBlc1wiKS5zaG93KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgJCh0YXIpLnBhcmVudCgpLmZpbmQoXCIudHlwZXNcIikuaGlkZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy/ngrnlh7vkuIvnqbrnmb3lpITvvIzkuIvmi4nmoYbmtojlpLFcclxuICAgICAgICAkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICB2YXIgZSA9IGUgfHwgd2luZG93LmV2ZW50O1xyXG4gICAgICAgICAgdmFyIHRhciA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDtcclxuICAgICAgICAgICQoXCIudHlwZXNcIikuaGlkZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8v6Zi75q2i5YaS5rOhXHJcbiAgICAgICAgJChcIi5mb3JtLXNlbGVjdFwiKS5jbGljayhmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgLy8gZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbn0pIl19
