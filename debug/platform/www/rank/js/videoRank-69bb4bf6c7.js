'use strict';

require.config({
  baseUrl: '../',
  paths: {
    'platformConf': 'public/js/platformConf-541e3fb1ce.js'
  }
});
require(['platformConf'], function (configpaths) {
  // configpaths.paths.dialog = "myspace/js/appDialog.js";
  require.config(configpaths);
  define('', ['jquery', 'template', 'layer', 'page', 'service', 'tools', 'banner', 'textScroll', 'tab', 'ajaxBanner', 'secondNav', 'footer', 'header'], function ($, template, layer, Page, service, tools, banner, textScroll, tab, ajaxBanner, secondNav, footer, header) {
    var pageSize = 20;
    var currentPage = 1;

    videoUploadRank($(".content_table"), 'videoUploadRank', pageSize, currentPage);

    function videoUploadRank($obj, temId, pageSize, currentPage) {
      var $data = {
        'pageSize': pageSize,
        'currentPage': currentPage
      };
      $.ajax({
        url: service.htmlHost + '/pf/api/rank/video',
        type: 'GET',
        data: $data,
        success: function success(data) {
          console.log(data);
          if (data && data.code == "success") {
            var html = "";
            if (data.data && data.data.datalist && data.data.datalist.length > 0) {
              html = template(temId, {
                'data': data.data.datalist,
                'currentPage': data.data.currentPage - 1,
                'pageSize': data.data.pageSize
              });
              if (data.data.currentPage == 1) {
                $("#pageTool").html("");
                renderPage('pageTool', data.data.totalCount, data.data.pageSize, videoUploadRank, $obj, temId);
              }
            } else {
              html = showprompt();
            }
            $obj.html(html);
          } else {
            layer.alert(data.msg, { icon: 0 });
          }
        },
        error: function error(data) {
          layer.alert("获取视频上传排行榜异常。", { icon: 0 });
        }
      });
    };

    function getvideoHotRank($obj, temId, pageSize, currentPage, sort) {
      var $data = {
        'pageSize': pageSize,
        'currentPage': currentPage - 1,
        'sort': sort
      };
      $.ajax({
        url: service.htmlHost + '/pf/api/direct/ktsl_heatVideo',
        type: 'GET',
        data: $data,
        success: function success(data) {
          if (data && data.status == "100000") {
            var html = "";
            if (data.result && data.result.data && data.result.data.length > 0) {
              html = template(temId, {
                'data': data.result.data,
                'currentPage': data.result.currentPage,
                'pageSize': data.result.pageSize
              });
              if (data.result.currentPage == 0) {
                $("#pageTool").html("");
                renderPage('pageTool', data.result.totalCount, data.result.pageSize, getvideoHotRank, $obj, temId, sort);
              }
            } else {
              html = showprompt();
            }
            $obj.html(html);
          } else {
            layer.alert(data.msg, { icon: 0 });
          }
        },
        error: function error(data) {
          layer.alert("获取视频热度排行榜异常。", { icon: 0 });
        }
      });
    };

    //翻页
    function renderPage(domId, total, pageSize, _callback, $obj, temId, softFile) {
      var p = new Page();
      p.init({
        target: '#' + domId,
        pagesize: pageSize,
        pageCount: 8,
        count: total,
        callback: function callback(current) {
          if (softFile) {
            _callback($obj, temId, pageSize, current, softFile);
          } else {
            _callback($obj, temId, pageSize, current);
          }
        }
      });
    }

    /**
     * 公用没有内容方法
     * @returns {string}
     */
    function showprompt() {
      return "<p id='no-content'>没有您查看的内容</p>";
    };
    template.helper('dateRound', function (date) {
      var value = Math.round(parseFloat(date) * 100) / 100;
      var xsd = value.toString().split(".");
      if (xsd.length == 1) {
        value = value.toString() + ".00";
        return value;
      }
      if (xsd.length > 1) {
        if (xsd[1].length < 2) {
          value = value.toString() + "0";
        }
        return value;
      }
    });

    $("body").delegate('.content_title ul li', 'click', function (e) {
      e.stopPropagation();
      if (!$(this).hasClass('active')) {
        $(this).addClass('active').siblings("li").removeClass('active');
        if ($(this).index() == 0) {
          $(".content_nav").hide();
          videoUploadRank($(".content_table"), 'videoUploadRank');
        } else if ($(this).index() == 1) {
          $(".content_nav").show();
          getvideoHotRank($(".content_table"), 'videoHotRank', pageSize, currentPage, 1);
        }
      }
    });
    $("body").delegate('.content_nav a', 'click', function (e) {
      e.stopPropagation();
      if (!$(this).hasClass('active')) {
        $(this).addClass('active').siblings("a").removeClass('active');
        getvideoHotRank($(".content_table"), 'videoHotRank', pageSize, currentPage, $(this).attr("data-value"));
      }
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJhbmsvanMvdmlkZW9SYW5rLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJiYXNlVXJsIiwicGF0aHMiLCJjb25maWdwYXRocyIsImRlZmluZSIsIiQiLCJ0ZW1wbGF0ZSIsImxheWVyIiwiUGFnZSIsInNlcnZpY2UiLCJ0b29scyIsImJhbm5lciIsInRleHRTY3JvbGwiLCJ0YWIiLCJhamF4QmFubmVyIiwic2Vjb25kTmF2IiwiZm9vdGVyIiwiaGVhZGVyIiwicGFnZVNpemUiLCJjdXJyZW50UGFnZSIsInZpZGVvVXBsb2FkUmFuayIsIiRvYmoiLCJ0ZW1JZCIsIiRkYXRhIiwiYWpheCIsInVybCIsImh0bWxIb3N0IiwidHlwZSIsImRhdGEiLCJzdWNjZXNzIiwiY29uc29sZSIsImxvZyIsImNvZGUiLCJodG1sIiwiZGF0YWxpc3QiLCJsZW5ndGgiLCJyZW5kZXJQYWdlIiwidG90YWxDb3VudCIsInNob3dwcm9tcHQiLCJhbGVydCIsIm1zZyIsImljb24iLCJlcnJvciIsImdldHZpZGVvSG90UmFuayIsInNvcnQiLCJzdGF0dXMiLCJyZXN1bHQiLCJkb21JZCIsInRvdGFsIiwiY2FsbGJhY2siLCJzb2Z0RmlsZSIsInAiLCJpbml0IiwidGFyZ2V0IiwicGFnZXNpemUiLCJwYWdlQ291bnQiLCJjb3VudCIsImN1cnJlbnQiLCJoZWxwZXIiLCJkYXRlIiwidmFsdWUiLCJNYXRoIiwicm91bmQiLCJwYXJzZUZsb2F0IiwieHNkIiwidG9TdHJpbmciLCJzcGxpdCIsImRlbGVnYXRlIiwiZSIsInN0b3BQcm9wYWdhdGlvbiIsImhhc0NsYXNzIiwiYWRkQ2xhc3MiLCJzaWJsaW5ncyIsInJlbW92ZUNsYXNzIiwiaW5kZXgiLCJoaWRlIiwic2hvdyIsImF0dHIiXSwibWFwcGluZ3MiOiI7O0FBQUFBLFFBQVFDLE1BQVIsQ0FBZTtBQUNiQyxXQUFTLEtBREk7QUFFYkMsU0FBTztBQUNMLG9CQUFnQjtBQURYO0FBRk0sQ0FBZjtBQU1BSCxRQUFRLENB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UUFBakIsQ0FBTCxFQUFpQztBQUMvQmpFLFVBQUUsSUFBRixFQUFRa0UsUUFBUixDQUFpQixRQUFqQixFQUEyQkMsUUFBM0IsQ0FBb0MsR0FBcEMsRUFBeUNDLFdBQXpDLENBQXFELFFBQXJEO0FBQ0E5Qix3QkFBZ0J0QyxFQUFFLGdCQUFGLENBQWhCLEVBQXFDLGNBQXJDLEVBQXFEYSxRQUFyRCxFQUErREMsV0FBL0QsRUFBNEVkLEVBQUUsSUFBRixFQUFRd0UsSUFBUixDQUFhLFlBQWIsQ0FBNUU7QUFDRDtBQUNGLEtBTkQ7QUFRRCxHQS9JSDtBQWdKRCxDQW5KRCIsImZpbGUiOiJyYW5rL2pzL3ZpZGVvUmFuay02OWJiNGJmNmM3LmpzIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZS5jb25maWcoe1xyXG4gIGJhc2VVcmw6ICcuLi8nLFxyXG4gIHBhdGhzOiB7XHJcbiAgICAncGxhdGZvcm1Db25mJzogJ3B1YmxpYy9qcy9wbGF0Zm9ybUNvbmYuanMnXHJcbiAgfVxyXG59KTtcclxucmVxdWlyZShbJ3BsYXRmb3JtQ29uZiddLCBmdW5jdGlvbiAoY29uZmlncGF0aHMpIHtcclxuICAvLyBjb25maWdwYXRocy5wYXRocy5kaWFsb2cgPSBcIm15c3BhY2UvanMvYXBwRGlhbG9nLmpzXCI7XHJcbiAgcmVxdWlyZS5jb25maWcoY29uZmlncGF0aHMpO1xyXG4gIGRlZmluZSgnJywgWydqcXVlcnknLCAndGVtcGxhdGUnLCAnbGF5ZXInLCAncGFnZScsICdzZXJ2aWNlJywgJ3Rvb2xzJywgJ2Jhbm5lcicsICd0ZXh0U2Nyb2xsJywgJ3RhYicsICdhamF4QmFubmVyJywgJ3NlY29uZE5hdicsICdmb290ZXInLCAnaGVhZGVyJ10sXHJcbiAgICBmdW5jdGlvbiAoJCwgdGVtcGxhdGUsIGxheWVyLCBQYWdlLCBzZXJ2aWNlLCB0b29scywgYmFubmVyLCB0ZXh0U2Nyb2xsLCB0YWIsIGFqYXhCYW5uZXIsIHNlY29uZE5hdiwgZm9vdGVyLCBoZWFkZXIpIHtcclxuICAgICAgdmFyIHBhZ2VTaXplID0gMjA7XHJcbiAgICAgIHZhciBjdXJyZW50UGFnZSA9IDE7XHJcblxyXG4gICAgICB2aWRlb1VwbG9hZFJhbmsoJChcIi5jb250ZW50X3RhYmxlXCIpLCAndmlkZW9VcGxvYWRSYW5rJywgcGFnZVNpemUsIGN1cnJlbnRQYWdlKTtcclxuXHJcbiAgICAgIGZ1bmN0aW9uIHZpZGVvVXBsb2FkUmFuaygkb2JqLCB0ZW1JZCwgcGFnZVNpemUsIGN1cnJlbnRQYWdlKSB7XHJcbiAgICAgICAgdmFyICRkYXRhID0ge1xyXG4gICAgICAgICAgJ3BhZ2VTaXplJzogcGFnZVNpemUsXHJcbiAgICAgICAgICAnY3VycmVudFBhZ2UnOiBjdXJyZW50UGFnZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgIHVybDogc2VydmljZS5odG1sSG9zdCArICcvcGYvYXBpL3JhbmsvdmlkZW8nLFxyXG4gICAgICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgICAgICBkYXRhOiAkZGF0YSxcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmNvZGUgPT0gXCJzdWNjZXNzXCIpIHtcclxuICAgICAgICAgICAgICB2YXIgaHRtbCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YSAmJiBkYXRhLmRhdGEuZGF0YWxpc3QgJiYgZGF0YS5kYXRhLmRhdGFsaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGh0bWwgPSB0ZW1wbGF0ZSh0ZW1JZCwge1xyXG4gICAgICAgICAgICAgICAgICAnZGF0YSc6IGRhdGEuZGF0YS5kYXRhbGlzdCxcclxuICAgICAgICAgICAgICAgICAgJ2N1cnJlbnRQYWdlJzogZGF0YS5kYXRhLmN1cnJlbnRQYWdlIC0gMSxcclxuICAgICAgICAgICAgICAgICAgJ3BhZ2VTaXplJzogZGF0YS5kYXRhLnBhZ2VTaXplXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhLmRhdGEuY3VycmVudFBhZ2UgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAkKFwiI3BhZ2VUb29sXCIpLmh0bWwoXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgIHJlbmRlclBhZ2UoJ3BhZ2VUb29sJywgZGF0YS5kYXRhLnRvdGFsQ291bnQsIGRhdGEuZGF0YS5wYWdlU2l6ZSwgdmlkZW9VcGxvYWRSYW5rLCAkb2JqLCB0ZW1JZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGh0bWwgPSBzaG93cHJvbXB0KCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICRvYmouaHRtbChodG1sKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBsYXllci5hbGVydChkYXRhLm1zZywge2ljb246IDB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBsYXllci5hbGVydChcIuiOt+WPluinhumikeS4iuS8oOaOkuihjOamnOW8guW4uOOAglwiLCB7aWNvbjogMH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgZnVuY3Rpb24gZ2V0dmlkZW9Ib3RSYW5rKCRvYmosIHRlbUlkLCBwYWdlU2l6ZSwgY3VycmVudFBhZ2UsIHNvcnQpIHtcclxuICAgICAgICB2YXIgJGRhdGEgPSB7XHJcbiAgICAgICAgICAncGFnZVNpemUnOiBwYWdlU2l6ZSxcclxuICAgICAgICAgICdjdXJyZW50UGFnZSc6IGN1cnJlbnRQYWdlIC0gMSxcclxuICAgICAgICAgICdzb3J0Jzogc29ydFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgIHVybDogc2VydmljZS5odG1sSG9zdCArICcvcGYvYXBpL2RpcmVjdC9rdHNsX2hlYXRWaWRlbycsXHJcbiAgICAgICAgICB0eXBlOiAnR0VUJyxcclxuICAgICAgICAgIGRhdGE6ICRkYXRhLFxyXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5zdGF0dXMgPT0gXCIxMDAwMDBcIikge1xyXG4gICAgICAgICAgICAgIHZhciBodG1sID0gXCJcIjtcclxuICAgICAgICAgICAgICBpZiAoZGF0YS5yZXN1bHQgJiYgZGF0YS5yZXN1bHQuZGF0YSAmJiBkYXRhLnJlc3VsdC5kYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGh0bWwgPSB0ZW1wbGF0ZSh0ZW1JZCwge1xyXG4gICAgICAgICAgICAgICAgICAnZGF0YSc6IGRhdGEucmVzdWx0LmRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICdjdXJyZW50UGFnZSc6IGRhdGEucmVzdWx0LmN1cnJlbnRQYWdlLFxyXG4gICAgICAgICAgICAgICAgICAncGFnZVNpemUnOiBkYXRhLnJlc3VsdC5wYWdlU2l6ZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5yZXN1bHQuY3VycmVudFBhZ2UgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAkKFwiI3BhZ2VUb29sXCIpLmh0bWwoXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgIHJlbmRlclBhZ2UoJ3BhZ2VUb29sJywgZGF0YS5yZXN1bHQudG90YWxDb3VudCwgZGF0YS5yZXN1bHQucGFnZVNpemUsIGdldHZpZGVvSG90UmFuaywgJG9iaiwgdGVtSWQsIHNvcnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBodG1sID0gc2hvd3Byb21wdCgpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAkb2JqLmh0bWwoaHRtbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgbGF5ZXIuYWxlcnQoZGF0YS5tc2csIHtpY29uOiAwfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgbGF5ZXIuYWxlcnQoXCLojrflj5bop4bpopHng63luqbmjpLooYzmppzlvILluLjjgIJcIiwge2ljb246IDB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8v57+76aG1XHJcbiAgICAgIGZ1bmN0aW9uIHJlbmRlclBhZ2UoZG9tSWQsIHRvdGFsLCBwYWdlU2l6ZSwgY2FsbGJhY2ssICRvYmosIHRlbUlkLCBzb2Z0RmlsZSkge1xyXG4gICAgICAgIHZhciBwID0gbmV3IFBhZ2UoKTtcclxuICAgICAgICBwLmluaXQoe1xyXG4gICAgICAgICAgdGFyZ2V0OiAnIycgKyBkb21JZCxcclxuICAgICAgICAgIHBhZ2VzaXplOiBwYWdlU2l6ZSxcclxuICAgICAgICAgIHBhZ2VDb3VudDogOCxcclxuICAgICAgICAgIGNvdW50OiB0b3RhbCxcclxuICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoY3VycmVudCkge1xyXG4gICAgICAgICAgICBpZiAoc29mdEZpbGUpIHtcclxuICAgICAgICAgICAgICBjYWxsYmFjaygkb2JqLCB0ZW1JZCwgcGFnZVNpemUsIGN1cnJlbnQsIHNvZnRGaWxlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBjYWxsYmFjaygkb2JqLCB0ZW1JZCwgcGFnZVNpemUsIGN1cnJlbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiDlhaznlKjmsqHmnInlhoXlrrnmlrnms5VcclxuICAgICAgICogQHJldHVybnMge3N0cmluZ31cclxuICAgICAgICovXHJcbiAgICAgIGZ1bmN0aW9uIHNob3dwcm9tcHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPHAgaWQ9J25vLWNvbnRlbnQnPuayoeacieaCqOafpeeci+eahOWGheWuuTwvcD5cIjtcclxuICAgICAgfTtcclxuICAgICAgdGVtcGxhdGUuaGVscGVyKCdkYXRlUm91bmQnLCBmdW5jdGlvbiAoZGF0ZSkge1xyXG4gICAgICAgIHZhciB2YWx1ZSA9IE1hdGgucm91bmQocGFyc2VGbG9hdChkYXRlKSAqIDEwMCkgLyAxMDA7XHJcbiAgICAgICAgdmFyIHhzZCA9IHZhbHVlLnRvU3RyaW5nKCkuc3BsaXQoXCIuXCIpO1xyXG4gICAgICAgIGlmICh4c2QubGVuZ3RoID09IDEpIHtcclxuICAgICAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKSArIFwiLjAwXCI7XHJcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh4c2QubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgaWYgKHhzZFsxXS5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKSArIFwiMFwiO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgJChcImJvZHlcIikuZGVsZWdhdGUoJy5jb250ZW50X3RpdGxlIHVsIGxpJywgJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcygnYWN0aXZlJykpIHtcclxuICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKFwibGlcIikucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgaWYgKCQodGhpcykuaW5kZXgoKSA9PSAwKSB7XHJcbiAgICAgICAgICAgICQoXCIuY29udGVudF9uYXZcIikuaGlkZSgpO1xyXG4gICAgICAgICAgICB2aWRlb1VwbG9hZFJhbmsoJChcIi5jb250ZW50X3RhYmxlXCIpLCAndmlkZW9VcGxvYWRSYW5rJyk7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKCQodGhpcykuaW5kZXgoKSA9PSAxKSB7XHJcbiAgICAgICAgICAgICQoXCIuY29udGVudF9uYXZcIikuc2hvdygpO1xyXG4gICAgICAgICAgICBnZXR2aWRlb0hvdFJhbmsoJChcIi5jb250ZW50X3RhYmxlXCIpLCAndmlkZW9Ib3RSYW5rJywgcGFnZVNpemUsIGN1cnJlbnRQYWdlLCAxKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICAkKFwiYm9keVwiKS5kZWxlZ2F0ZSgnLmNvbnRlbnRfbmF2IGEnLCAnY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgaWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xyXG4gICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoXCJhXCIpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgIGdldHZpZGVvSG90UmFuaygkKFwiLmNvbnRlbnRfdGFibGVcIiksICd2aWRlb0hvdFJhbmsnLCBwYWdlU2l6ZSwgY3VycmVudFBhZ2UsICQodGhpcykuYXR0cihcImRhdGEtdmFsdWVcIikpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbn0pXHJcblxyXG5cclxuXHJcbiJdfQ==
